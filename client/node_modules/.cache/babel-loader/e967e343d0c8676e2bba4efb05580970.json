{"remainingRequest":"C:\\Users\\nuno_\\Desktop\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\nuno_\\Desktop\\client\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\nuno_\\Desktop\\client\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\nuno_\\Desktop\\client\\src\\views\\AddLoan.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\nuno_\\Desktop\\client\\src\\views\\AddLoan.vue","mtime":1546794001827},{"path":"C:\\Users\\nuno_\\Desktop\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\nuno_\\Desktop\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\nuno_\\Desktop\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\nuno_\\Desktop\\client\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Object$keys from \"C:\\\\Users\\\\nuno_\\\\Desktop\\\\client\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/object/keys\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\nuno_\\\\Desktop\\\\client\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport AddBookManuallyPanel from './AddBookManuallyPanel';\nimport PersonalReadingService from '@/services/PersonalReadingService';\nimport BookService from '@/services/BookService';\nimport AuthenticationService from '@/services/AuthenticationService';\nimport LoanService from '@/services/LoanService';\nexport default {\n  components: {\n    AddBookManuallyPanel: AddBookManuallyPanel\n  },\n  data: function data() {\n    return {\n      dialogBook: false,\n      optionFrom: ['Me', 'External user'],\n      optionsTo: ['Me', 'Other user', 'External user'],\n      Books: [],\n      PersonalReadingIds: [],\n      book: {\n        title: null,\n        subtitle: null,\n        authors: null,\n        publishDate: null,\n        nrPages: null,\n        publisher: null,\n        language: null,\n        thumbnailUrl: null\n      },\n      Loan: {\n        UserLenterId: null,\n        UserBorrowerUsernameOrEmail: null,\n        PersonalReadingId: null,\n        BookId: null,\n        startDate: new Date().toISOString().substr(0, 10),\n        externalUserName: null,\n        status: null\n      },\n      userLoggedInUsername: '@' + this.$store.state.user.username,\n      bookNamesSelect: null,\n      lenterIsUser: null,\n      borrowerIsUser: null,\n      selectFrom: null,\n      selectTo: null,\n      datepickerStart: false,\n      datepickerEnd: false,\n      datepicker: null,\n      dialogLenter: false,\n      dialogBorrower: false,\n      userLabel: false,\n      error: null,\n      success: null,\n      required: function required(value) {\n        return !!value || 'Required.';\n      }\n    };\n  },\n  methods: {\n    addLoan: function () {\n      var _addLoan = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this = this;\n\n        var UserBorrower, selectedIndex, personalReadingId, response, areAllFieldsFilledIn, responseBook, _response;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n\n                if (!(this.selectFrom == \"Me\")) {\n                  _context.next = 19;\n                  break;\n                }\n\n                this.Loan.IdLenter = this.$store.state.user.id;\n\n                if (!this.borrowerIsUser) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.next = 6;\n                return AuthenticationService.getUserByEmailOrUsername(this.Loan.UserBorrowerUsernameOrEmail);\n\n              case 6:\n                UserBorrower = _context.sent.data;\n                this.Loan.status = 'Lent to @' + UserBorrower.username;\n                this.Loan.UserBorrowerId = UserBorrower.id;\n\n              case 9:\n                if (!this.borrowerIsUser) {\n                  this.Loan.status = 'Lent to ' + this.Loan.externalUserName + '[outside user]';\n                }\n\n                selectedIndex = this.Books.indexOf(this.bookNamesSelect); //searching for the PersonalReadingId\n\n                personalReadingId = this.PersonalReadingIds[selectedIndex]; //of the select option books\n\n                _context.next = 14;\n                return LoanService.addLoan({\n                  PersonalReadingId: personalReadingId,\n                  UserLenterId: this.$store.state.user.id,\n                  UserBorrowerId: this.Loan.UserBorrowerId,\n                  ExternalBookId: null,\n                  startDate: this.Loan.startDate,\n                  status: this.Loan.status\n                });\n\n              case 14:\n                response = _context.sent;\n                this.error = '';\n                this.success = 'Loan added to your list.';\n                _context.next = 37;\n                break;\n\n              case 19:\n                if (!(this.selectFrom == 'External user')) {\n                  _context.next = 36;\n                  break;\n                }\n\n                this.Loan.status = 'Lent from ' + this.Loan.externalUserName + '[outside user]'; //creating the book\n\n                if (!this.subtitle) {\n                  this.book.subtitle = 'No subtitle';\n                }\n\n                areAllFieldsFilledIn = _Object$keys(this.book).every(function (key) {\n                  return !!_this.book[key];\n                });\n\n                if (areAllFieldsFilledIn) {\n                  _context.next = 27;\n                  break;\n                }\n\n                this.error = 'Please fill all the required fields about the book.';\n                this.dialog = false;\n                return _context.abrupt(\"return\");\n\n              case 27:\n                _context.next = 29;\n                return BookService.createBook(this.book);\n\n              case 29:\n                responseBook = _context.sent;\n                _context.next = 32;\n                return LoanService.addLoan({\n                  PersonalReadingId: null,\n                  UserLenterId: null,\n                  UserBorrowerId: this.$store.state.user.id,\n                  ExternalBookId: responseBook.data.id,\n                  startDate: this.Loan.startDate,\n                  status: this.Loan.status\n                });\n\n              case 32:\n                _response = _context.sent;\n                this.success = 'Loan added to your list';\n                _context.next = 37;\n                break;\n\n              case 36:\n                this.error = 'Some error has occured. Please try again later.';\n\n              case 37:\n                _context.next = 43;\n                break;\n\n              case 39:\n                _context.prev = 39;\n                _context.t0 = _context[\"catch\"](0);\n                this.success = null;\n                this.error = _context.t0.response.data.error;\n\n              case 43:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 39]]);\n      }));\n\n      function addLoan() {\n        return _addLoan.apply(this, arguments);\n      }\n\n      return addLoan;\n    }() // lenterIsUserMethod(){\n    //     this.lenterIsUser = true\n    //     this.dialogLenter = false\n    // },\n    // lenterIsNotUserMethod(){\n    //     this.lenterIsUser = false\n    //     this.dialogLenter = false\n    // },\n    // borrowerIsUserMethod(){\n    //     this.borrowerIsUser = true\n    //     this.dialogBorrower = false\n    // },\n    // borrowerIsNotUserMethod(){\n    //     this.borrowerIsUser = false\n    //     this.dialogBorrower = false\n    // }\n\n  },\n  watch: {\n    'selectFrom': function () {\n      var _selectFrom = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(newVal) {\n        var personalReadingsId, i, obj, bookName;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.selectTo == newVal) {\n                  this.selectFrom = '';\n                  this.selectTo = '';\n                }\n\n                if (!(newVal == 'Other user')) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                this.selectTo = 'Me';\n                this.lenterIsUser = true;\n                this.borrowerIsUser = null; // this.dialogLenter=true\n\n                _context2.next = 28;\n                break;\n\n              case 7:\n                if (!(newVal == 'Me')) {\n                  _context2.next = 27;\n                  break;\n                }\n\n                this.Books = []; //clears the array, in case the user changed library\n                //this.selectTo = ''  \n\n                this.lenterIsUser = null;\n                this.UserLenterId = this.$store.state.user.id; //Search on the backend for book names from user that's logged in, in the library that he has open\n\n                _context2.next = 13;\n                return PersonalReadingService.getPersonalReadingByLibraryUser(this.$store.state.user.id, this.$store.state.library.id);\n\n              case 13:\n                personalReadingsId = _context2.sent.data;\n                i = 0;\n\n              case 15:\n                if (!(i < personalReadingsId.length)) {\n                  _context2.next = 25;\n                  break;\n                }\n\n                obj = personalReadingsId[i];\n                _context2.next = 19;\n                return BookService.getBookById(obj.BookId);\n\n              case 19:\n                bookName = _context2.sent;\n                this.Books.push(bookName.data.title);\n                this.PersonalReadingIds.push(bookName.data.id);\n\n              case 22:\n                i++;\n                _context2.next = 15;\n                break;\n\n              case 25:\n                _context2.next = 28;\n                break;\n\n              case 27:\n                if (newVal == 'External user') {\n                  this.selectTo = 'Me';\n                  this.lenterIsUser = false;\n                }\n\n              case 28:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function selectFrom(_x) {\n        return _selectFrom.apply(this, arguments);\n      }\n\n      return selectFrom;\n    }(),\n    'selectTo': function selectTo(newVal) {\n      //  if (this.selectFrom == newVal){\n      //       this.selectTo = ''\n      //       this.selectFrom = ''\n      //       return\n      //   }\n      // if (newVal == 'Other user'){\n      //     this.borrowerIsUser = true\n      //     this.selectFrom = 'Me'\n      // } else \n      if (newVal == 'Me') {\n        this.UserBorrowerId = this.$store.state.user.id;\n        this.borrowerIsUser = null;\n      } else if (newVal == 'External user') {\n        this.Loan.UserBorrowerUsernameOrEmail = '';\n        this.selectFrom = 'Me';\n        this.borrowerIsUser = false;\n      } else if (newVal == 'Other user') {\n        this.Loan.externalUserName = '';\n        this.selectFrom = 'Me';\n        this.borrowerIsUser = true; //IMPLEMENT HERE -> TONS OF BUGSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS\n      }\n\n      if (this.selectFrom == newVal) {\n        this.selectFrom = '';\n      }\n    },\n    '$store.state.library': function $storeStateLibrary(newVal) {\n      this.selectTo = '';\n      this.selectFrom = '';\n      this.lenterIsUser = null;\n      this.borrowerIsUser = null;\n      this.bookNamesSelect = '';\n    }\n  }\n};",{"version":3,"sources":["AddLoan.vue"],"names":[],"mappings":"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","sourcesContent":["<script>/*eslint-disable */ </script>\r\n<template>\r\n  <v-container fill-height fluid grid-list-xl>\r\n    <v-layout justify-center wrap>\r\n      <v-flex xs12 md8>\r\n        <material-card color=\"green\" title=\"Register\">\r\n          <v-form>\r\n            <v-container py-0>  \r\n                <v-layout wrap>\r\n                  <v-flex xs12 md6>\r\n                    <v-select :items=\"optionFrom\" v-model=\"selectFrom\" label=\"From\"></v-select>\r\n                  </v-flex>\r\n                  <v-flex xs12 md6>\r\n                    <v-select :items=\"optionsTo\"  v-model=\"selectTo\" label=\"To\"></v-select>\r\n                  </v-flex>\r\n                  <v-flex xs12 md6>\r\n                    <v-text-field label=\"From\"  v-if=\"!lenterIsUser && lenterIsUser != null\"  placeholder=\"Person name and surname\" required :rules=\"[required]\" type=\"text\" v-model=\"Loan.externalUserName\"></v-text-field>    \r\n                    <v-text-field label=\"From\"  v-if=\"this.selectFrom=='Me'\" v-model=\"userLoggedInUsername\" disabled type=\"text\" ></v-text-field>        \r\n                  </v-flex>\r\n                  <v-flex xs12 md6>\r\n                    <v-text-field label=\"To\"  v-if=\"borrowerIsUser\" placeholder=\"User e-mail or @username\" required :rules=\"[required]\" type=\"text\" v-model=\"Loan.UserBorrowerUsernameOrEmail\"></v-text-field>\r\n                    <v-text-field label=\"To\" v-if=\"!borrowerIsUser && borrowerIsUser != null\" placeholder=\"Person name and surname\" required :rules=\"[required]\" type=\"text\" v-model=\"Loan.externalUserName\"></v-text-field>\r\n                    <v-text-field label=\"From\"  v-if=\"this.selectTo=='Me'\" v-model=\"userLoggedInUsername\" disabled type=\"text\" ></v-text-field>\r\n                  </v-flex>\r\n                  <v-flex xs12 md12>\r\n                    <v-autocomplete v-if=\"selectFrom=='Me'\" v-model=\"bookNamesSelect\" :items=\"Books\" :label=\"`Book`\" persistent-hint>\r\n                    <v-slide-x-reverse-transition slot=\"append-outer\" mode=\"out-in\">\r\n                    </v-slide-x-reverse-transition>\r\n                    </v-autocomplete>\r\n                  </v-flex>\r\n                  <v-flex xs12 md12>\r\n                    <v-text-field v-if=\"!lenterIsUser && lenterIsUser != null\" label=\"Book\" required :rules=\"[required]\" v-model=\"book.title\" @click=\"dialogBook=true\" ></v-text-field>\r\n                  </v-flex>\r\n                <br>\r\n               <v-flex xs12 md6>\r\n                <v-menu :close-on-content-click=\"false\" v-model=\"datepickerStart\" :nudge-right=\"40\" lazy transition=\"scale-transition\" offset-y full-width min-width=\"290px\">\r\n                  <v-text-field slot=\"activator\" v-model=\"Loan.startDate\" label=\"Start date\" prepend-icon=\"event\" readonly></v-text-field>\r\n                  <v-date-picker v-model=\"Loan.startDate\" @input=\"datepickerStart = false\"></v-date-picker>\r\n                </v-menu>\r\n               </v-flex>            \r\n                <br>\r\n                <v-alert v-if=\"success\" :value=\"true\" type=\"success\">\r\n                {{success}}.\r\n                </v-alert>\r\n                <v-alert  v-if=\"error\" :value=\"true\" type=\"error\">\r\n                {{error}}\r\n                </v-alert>\r\n                <br>\r\n                <v-flex xs12 text-xs-right>\r\n                <v-btn color=\"success\" v-if=\"!lenterIsUser && lenterIsUser != null\" dark @click=\"dialogBook = true\">Edit book </v-btn> \r\n                    <v-btn color=\"success\" @click=\"addLoan\"> Submit </v-btn>\r\n                    </v-flex>\r\n              <v-dialog v-model=\"dialogBook\" fullscreen hide-overlay transition=\"dialog-bottom-transition\" scrollable>\r\n                <v-card tile>\r\n                <v-toolbar card dark color=\"primary\">\r\n                    <v-btn icon dark @click=\"dialogBook = false\">\r\n                        <v-icon>close</v-icon>\r\n                    </v-btn>\r\n                    <v-toolbar-title>Book information</v-toolbar-title>\r\n                    <v-spacer></v-spacer>\r\n                    <v-toolbar-items>\r\n                        <v-btn dark flat @click=\"dialogBook = false\">Save</v-btn>\r\n                    </v-toolbar-items>\r\n                </v-toolbar>\r\n            <v-card-text>\r\n              <v-flex xs6 offset-xs3>\r\n              <v-text-field label=\"Title\"  required :rules=\"[required]\" v-model=\"book.title\"></v-text-field>\r\n              <v-text-field label=\"Subtitle\"  v-model=\"book.subtitle\"></v-text-field>\r\n              <v-text-field label=\"Authors\"  required :rules=\"[required]\" v-model=\"book.authors\"></v-text-field>\r\n              <v-flex xs12 sm6 md4>\r\n                <v-menu :close-on-content-click=\"false\" v-model=\"datepicker\" :nudge-right=\"40\" lazy transition=\"scale-transition\" offset-y full-width min-width=\"290px\">\r\n                  <v-text-field slot=\"activator\" v-model=\"book.publishDate\" label=\"Publish date\" prepend-icon=\"event\" readonly></v-text-field>\r\n                  <v-date-picker v-model=\"book.publishDate\" @input=\"datepicker = false\"></v-date-picker>\r\n                </v-menu>\r\n              </v-flex>\r\n              <v-text-field label=\"Number of pages\" type=\"number\" required :rules=\"[required]\"  v-model=\"book.nrPages\"></v-text-field>\r\n              <v-text-field label=\"Publisher\"  v-model=\"book.publisher\"></v-text-field>\r\n              <v-text-field label=\"Language\" required :rules=\"[required]\"  v-model=\"book.language\"></v-text-field>\r\n              <v-text-field label=\"Thumbnail URL\" required :rules=\"[required]\"  v-model=\"book.thumbnailUrl\"></v-text-field>\r\n                <v-btn dark flat class=\"blue\" @click=\"dialogBook = false\">Save</v-btn>\r\n              </v-flex>\r\n            </v-card-text>\r\n  \r\n            <div style=\"flex: 1 1 auto;\"></div>\r\n          </v-card>\r\n        </v-dialog>\r\n                </v-layout>\r\n</v-container>\r\n          </v-form>\r\n        </material-card>\r\n      </v-flex>\r\n    </v-layout>\r\n  </v-container>\r\n</template>\r\n\r\n<script>\r\n  import AddBookManuallyPanel from './AddBookManuallyPanel'\r\n  import PersonalReadingService from '@/services/PersonalReadingService'\r\n  import BookService from '@/services/BookService'\r\n  import AuthenticationService from '@/services/AuthenticationService'\r\n  import LoanService from '@/services/LoanService'\r\n\r\n  export default {\r\n    components: {\r\n      AddBookManuallyPanel\r\n    },\r\n    data() {\r\n      return {\r\n        dialogBook: false,\r\n        optionFrom: ['Me', 'External user'],\r\n        optionsTo: ['Me', 'Other user', 'External user'],\r\n        Books: [],\r\n        PersonalReadingIds: [],\r\n        book: {\r\n            title: null,\r\n            subtitle: null,\r\n            authors: null,\r\n            publishDate: null,\r\n            nrPages: null,\r\n            publisher: null,\r\n            language: null,\r\n            thumbnailUrl : null\r\n          },\r\n        Loan : {\r\n            UserLenterId: null,\r\n            UserBorrowerUsernameOrEmail: null,\r\n            PersonalReadingId: null,\r\n            BookId: null,\r\n            startDate: new Date().toISOString().substr(0, 10),\r\n            externalUserName: null,\r\n            status: null\r\n        },\r\n        userLoggedInUsername: '@'+this.$store.state.user.username,\r\n        bookNamesSelect: null,\r\n        lenterIsUser: null,\r\n        borrowerIsUser: null,\r\n        selectFrom: null,\r\n        selectTo: null,\r\n        datepickerStart: false,\r\n        datepickerEnd: false,\r\n        datepicker: null,\r\n        dialogLenter: false,\r\n        dialogBorrower: false,\r\n        userLabel: false,\r\n        error: null,\r\n        success: null,\r\n        required: (value) => !!value || 'Required.'\r\n      }\r\n    },\r\n    methods: {\r\n      async addLoan() {\r\n        try {\r\n         if (this.selectFrom==\"Me\"){\r\n           this.Loan.IdLenter = this.$store.state.user.id\r\n           if(this.borrowerIsUser){\r\n             const UserBorrower = (await AuthenticationService.getUserByEmailOrUsername(this.Loan.UserBorrowerUsernameOrEmail)).data\r\n             this.Loan.status = 'Lent to @'+UserBorrower.username\r\n             this.Loan.UserBorrowerId = UserBorrower.id\r\n           }\r\n           if(!(this.borrowerIsUser)){\r\n           this.Loan.status = 'Lent to '+ this.Loan.externalUserName + '[outside user]'\r\n           }\r\n\r\n          let selectedIndex = this.Books.indexOf(this.bookNamesSelect)      //searching for the PersonalReadingId\r\n          const personalReadingId = this.PersonalReadingIds[selectedIndex]  //of the select option books\r\n\r\n          const response = await LoanService.addLoan({\r\n            PersonalReadingId : personalReadingId,\r\n            UserLenterId: this.$store.state.user.id ,\r\n            UserBorrowerId: this.Loan.UserBorrowerId,\r\n            ExternalBookId: null,\r\n            startDate: this.Loan.startDate,\r\n            status: this.Loan.status\r\n         })\r\n         this.error= ''\r\n         this.success = 'Loan added to your list.'\r\n         } else if (this.selectFrom == 'External user') {\r\n           this.Loan.status = 'Lent from '+ this.Loan.externalUserName + '[outside user]'\r\n        \r\n          //creating the book\r\n          if (!(this.subtitle)){\r\n            this.book.subtitle = 'No subtitle'\r\n          }\r\n          const areAllFieldsFilledIn = Object\r\n            .keys(this.book)\r\n            .every(key => !!this.book[key])\r\n            if (!areAllFieldsFilledIn){\r\n              this.error= 'Please fill all the required fields about the book.'\r\n              this.dialog = false\r\n              return\r\n            }\r\n            const responseBook = await BookService.createBook(this.book)\r\n            //creating the loan\r\n           const response = await LoanService.addLoan({\r\n            PersonalReadingId : null,\r\n            UserLenterId: null,\r\n            UserBorrowerId: this.$store.state.user.id,\r\n            ExternalBookId: responseBook.data.id,\r\n            startDate: this.Loan.startDate,\r\n            status: this.Loan.status\r\n         })\r\n          this.success = 'Loan added to your list'\r\n         } else {\r\n           this.error = 'Some error has occured. Please try again later.'\r\n         }\r\n        } catch (error) {\r\n          this.success = null\r\n          this.error = error.response.data.error\r\n        }\r\n      }\r\n      // lenterIsUserMethod(){\r\n      //     this.lenterIsUser = true\r\n      //     this.dialogLenter = false\r\n      // },\r\n      // lenterIsNotUserMethod(){\r\n      //     this.lenterIsUser = false\r\n      //     this.dialogLenter = false\r\n      // },\r\n      // borrowerIsUserMethod(){\r\n      //     this.borrowerIsUser = true\r\n      //     this.dialogBorrower = false\r\n      // },\r\n      // borrowerIsNotUserMethod(){\r\n      //     this.borrowerIsUser = false\r\n      //     this.dialogBorrower = false\r\n      // }\r\n    },\r\n    watch: {\r\n        'selectFrom': async function(newVal) {\r\n            if (this.selectTo == newVal){\r\n                this.selectFrom = ''\r\n                this.selectTo = ''\r\n                \r\n            }\r\n            if (newVal == 'Other user'){\r\n                    this.selectTo = 'Me'\r\n                    this.lenterIsUser = true\r\n                    this.borrowerIsUser = null                   \r\n                   // this.dialogLenter=true\r\n            } else if (newVal == 'Me') {\r\n                    this.Books = [] //clears the array, in case the user changed library\r\n                    //this.selectTo = ''  \r\n                    this.lenterIsUser = null  \r\n                    this.UserLenterId = this.$store.state.user.id\r\n                    //Search on the backend for book names from user that's logged in, in the library that he has open\r\n                    const personalReadingsId = (await PersonalReadingService.getPersonalReadingByLibraryUser(this.$store.state.user.id, this.$store.state.library.id)).data\r\n                    for(var i = 0; i < personalReadingsId.length; i++) {\r\n                      var obj = personalReadingsId[i];\r\n                      const bookName = await BookService.getBookById(obj.BookId)\r\n                       this.Books.push(bookName.data.title);\r\n                       this.PersonalReadingIds.push(bookName.data.id);\r\n                    }\r\n                    // const bookName = await BookService.getBookById(personalReadingsId.data.BookId)\r\n                    // alert(JSON.stringify(bookName))\r\n                    \r\n            } else if (newVal == 'External user'){\r\n\r\n                this.selectTo='Me'\r\n                this.lenterIsUser = false             \r\n            }\r\n        },\r\n        'selectTo': function (newVal) {\r\n          //  if (this.selectFrom == newVal){\r\n          //       this.selectTo = ''\r\n          //       this.selectFrom = ''\r\n          //       return\r\n          //   }\r\n            // if (newVal == 'Other user'){\r\n            //     this.borrowerIsUser = true\r\n            //     this.selectFrom = 'Me'\r\n            // } else \r\n            if (newVal == 'Me') {\r\n                this.UserBorrowerId = this.$store.state.user.id\r\n                this.borrowerIsUser = null\r\n            } else  if (newVal == 'External user'){\r\n              this.Loan.UserBorrowerUsernameOrEmail = ''\r\n              this.selectFrom = 'Me'\r\n              this.borrowerIsUser = false\r\n            } else if (newVal == 'Other user'){\r\n              this.Loan.externalUserName = ''\r\n              this.selectFrom = 'Me'\r\n              this.borrowerIsUser = true\r\n              //IMPLEMENT HERE -> TONS OF BUGSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS\r\n            }\r\n\r\n            if (this.selectFrom == newVal){\r\n                    this.selectFrom = ''\r\n            } \r\n            \r\n          },\r\n          '$store.state.library': function (newVal) {\r\n            this.selectTo = ''\r\n            this.selectFrom = ''\r\n            this.lenterIsUser = null\r\n            this.borrowerIsUser = null\r\n            this.bookNamesSelect = ''\r\n          }\r\n\r\n    }\r\n  }\r\n  \r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"],"sourceRoot":"src\\views"}]}